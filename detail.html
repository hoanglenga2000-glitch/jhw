<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å‘˜è¯¦æƒ… | æ™ºæ…§å®¶æ•™æ¡¥</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* âœ¨ è¶…çº§è§†è§‰ä¼˜åŒ–ç‰ˆ CSS */
        :root { 
            --primary: #6366F1; 
            --primary-light: #818CF8;
            --accent: #F59E0B; 
            --bg-dark: #0F172A; 
            --bg-card: rgba(30, 41, 59, 0.7); 
            --text: #F8FAFC; 
            --text-gray: #9CA3AF; 
            --border: rgba(255, 255, 255, 0.12); 
            --shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 16px 48px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.4);
        }
        body { 
            background: linear-gradient(135deg, #0F172A 0%, #1E1B4B 50%, #312E81 100%);
            background-attachment: fixed;
            color: var(--text); 
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif; 
            margin: 0; 
            padding-bottom: 60px; 
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(168, 85, 247, 0.15) 0%, transparent 50%);
            z-index: -2;
            pointer-events: none;
        }
        a { text-decoration: none; color: inherit; transition: all 0.3s ease; }
        .bg-glow-spot { 
            position: fixed; 
            width: 600px; 
            height: 600px; 
            background: radial-gradient(circle, rgba(99,102,241,0.12), transparent 60%); 
            border-radius: 50%; 
            pointer-events: none; 
            z-index: -1;
            filter: blur(80px);
        }
        .header { 
            max-width: 1100px; 
            margin: 0 auto; 
            padding: 20px 24px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1.5px solid var(--border); 
            background: rgba(15, 23, 42, 0.85); 
            backdrop-filter: blur(20px) saturate(180%);
            position: sticky; 
            top:0; 
            z-index: 10;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        }
        .header-logo { 
            font-weight: 900; 
            font-size: 1.3rem; 
            display: flex; 
            align-items: center; 
            gap: 12px;
            background: linear-gradient(135deg, #FFFFFF, #E0E7FF);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: transform 0.3s ease;
        }
        .header-logo:hover { transform: scale(1.05); }
        .header-logo i { 
            color: var(--primary);
            filter: drop-shadow(0 0 8px rgba(99, 102, 241, 0.5));
        }
        .container { max-width: 1100px; margin: 30px auto; display: grid; grid-template-columns: 7fr 3fr; gap: 35px; padding: 0 24px; }
        .card { 
            background: var(--bg-card);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1.5px solid var(--border); 
            border-radius: 28px; 
            padding: 40px; 
            margin-bottom: 30px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .card:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }
        .tutor-hero { 
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(38, 46, 61, 0.9)); 
            position: relative; 
            overflow: hidden;
        }
        .tutor-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }
        .tutor-profile-top { 
            display: flex; 
            gap: 30px; 
            align-items: center; 
            position: relative; 
            z-index: 1; 
        }
        .avatar { 
            width: 130px; 
            height: 130px; 
            border-radius: 50%; 
            object-fit: cover; 
            border: 4px solid rgba(15, 23, 42, 0.8); 
            box-shadow: 0 12px 32px rgba(0,0,0,0.4), 0 0 0 1px rgba(99, 102, 241, 0.3);
            transition: transform 0.4s ease;
        }
        .avatar:hover {
            transform: scale(1.05) rotate(5deg);
        }
        .tutor-info h1 { 
            margin: 0 0 15px 0; 
            font-size: 2.2rem;
            background: linear-gradient(135deg, #FFFFFF, #E0E7FF);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        .tag { 
            background: linear-gradient(135deg, rgba(99,102,241,0.2), rgba(168,85,247,0.2));
            color: #A5B4FC; 
            padding: 8px 16px; 
            border-radius: 30px; 
            font-size: 0.85rem; 
            margin-right: 10px;
            margin-bottom: 8px;
            border: 1.5px solid rgba(99,102,241,0.3);
            backdrop-filter: blur(10px);
            display: inline-block;
            transition: all 0.3s ease;
        }
        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        .stats-bar { 
            display: flex; 
            gap: 20px; 
            margin-top: 30px; 
            padding-top: 25px; 
            border-top: 1.5px solid var(--border); 
        }
        .stat-box { 
            flex: 1; 
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            padding: 20px; 
            border-radius: 20px; 
            text-align: center; 
            border: 1.5px solid var(--border);
            transition: all 0.3s ease;
        }
        .stat-box:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(99, 102, 241, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        .stat-value { 
            font-weight: 900; 
            font-size: 1.8rem; 
            color: var(--accent);
            text-shadow: 0 2px 10px rgba(245, 158, 11, 0.3);
        }
        .stat-label { 
            font-size: 0.9rem; 
            color: var(--text-gray); 
            margin-top: 8px;
            font-weight: 500;
        }
        .section-title { font-size: 1.3rem; color: white; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        .section-title i { color: var(--primary); }
        .content-text { line-height: 1.8; color: #D1D5DB; }
        .booking-card { 
            background: linear-gradient(to bottom right, rgba(30, 41, 59, 0.9), rgba(22, 30, 46, 0.95));
            backdrop-filter: blur(20px) saturate(180%);
            border: 1.5px solid var(--border); 
            border-radius: 28px; 
            padding: 40px; 
            position: sticky; 
            top: 100px; 
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
            z-index: 100; 
        }
        .price-val { 
            font-size: 3.2rem; 
            font-weight: 900; 
            color: var(--accent);
            text-shadow: 0 2px 15px rgba(245, 158, 11, 0.4);
            letter-spacing: -0.02em;
        }
        .select-box, .form-area { 
            width: 100%; 
            padding: 16px 20px; 
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border: 1.5px solid var(--border); 
            color: white; 
            border-radius: 14px; 
            margin-bottom: 20px; 
            outline: none; 
            font-family: inherit;
            transition: all 0.3s ease;
        }
        /* select é€‰é¡¹çš„é¢œè‰²é€‚é… */
        .form-area option {
            background-color: #0F172A;
            color: white;
        }
        .form-area:focus {
            border-color: var(--primary);
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2), 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        input[type="datetime-local"]::-webkit-calendar-picker-indicator { filter: invert(1); cursor: pointer; }
        .btn { 
            width: 100%; 
            padding: 18px; 
            border-radius: 16px; 
            border: none; 
            font-weight: 700; 
            font-size: 1rem; 
            cursor: pointer; 
            margin-bottom: 14px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn-primary { 
            background: linear-gradient(135deg, var(--primary), var(--primary-light), #A855F7);
            background-size: 200% 200%;
            animation: btnGradient 3s ease infinite;
            color: white; 
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        @keyframes btnGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        .btn-primary:hover { 
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.5);
        }
        .btn-booked { background: linear-gradient(135deg, #10B981, #059669); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); cursor: default; }
        .btn-chat-active { background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; border: 1px solid #7C3AED; }
        .btn-rebook { background: linear-gradient(135deg, #F59E0B, #D97706); color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text-gray); }
        .trust-badges { display: flex; justify-content: center; gap: 20px; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-gray); }
        .review-item { border-bottom: 1px solid var(--border); padding: 25px 0; }
        .review-user { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .review-avatar { width: 40px; height: 40px; background: #374151; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #818CF8; }
        .stars { color: var(--accent); }
        .review-content { background: rgba(255,255,255,0.03); padding: 15px 20px; border-radius: 12px; color: var(--text); }
        .empty-state { text-align:center; padding:40px; color:var(--text-gray); background:rgba(255,255,255,0.02); border-radius:16px; border: 2px dashed var(--border); }
        
        /* âœ¨ å¢å¼ºç‰ˆï¼šå¿ƒå½¢æ”¶è—æŒ‰é’® */
        .btn-fav { 
            position: absolute; 
            right: 20px; 
            top: 20px;
            background: rgba(255,255,255,0.12);
            backdrop-filter: blur(10px);
            width: 50px; 
            height: 50px; 
            border-radius: 50%;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1.5px solid rgba(255,255,255,0.2);
            z-index: 10;
        }
        .btn-fav:hover { 
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }
        .btn-fav.active { 
            background: rgba(239, 68, 68, 0.25);
            border-color: #EF4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }
        .btn-fav.active i { 
            color: #EF4444;
            animation: heartBeat 0.6s ease;
        }
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="bg-glow-spot" style="top:-20%; left:-10%"></div>
    <div class="bg-glow-spot" style="bottom:-20%; right:-10%"></div>

    <div class="header">
        <div class="header-logo"><i class="fas fa-graduation-cap"></i> æ™ºæ…§å®¶æ•™æ¡¥</div>
        <a href="index.html" class="btn-outline" style="width:auto; padding:8px 20px; margin:0;">è¿”å›é¦–é¡µ</a>
    </div>

    <div class="container">
        <div class="main-col">
            <div class="card tutor-hero">
                <div class="tutor-profile-top">
                    <img id="tAvatar" src="" class="avatar">
                    <div class="tutor-info">
                        <h1 id="tName">åŠ è½½ä¸­...</h1>
                        <div id="tTags"></div>
                    </div>
                    <div class="btn-fav" id="favBtn" onclick="toggleFav()">
                        <i class="far fa-heart" style="font-size:1.2rem; color:white;"></i>
                    </div>
                </div>
                <div class="stats-bar">
                    <div class="stat-box"><div class="stat-value">5.0 <i class="fas fa-star" style="font-size:1rem"></i></div><div class="stat-label">ç»¼åˆè¯„åˆ†</div></div>
                    <div class="stat-box"><div class="stat-value">1 <span style="font-size:1rem">å¹´</span></div><div class="stat-label">æ•™é¾„</div></div>
                    <div class="stat-box"><div class="stat-value">100+</div><div class="stat-label">æˆè¯¾æ—¶é•¿</div></div>
                </div>
            </div>

            <div class="card">
                <h2 class="section-title"><i class="fas fa-user-tie"></i> è‡ªæˆ‘ä»‹ç»</h2>
                <p id="tIntro" class="content-text">æš‚æ— ä»‹ç»</p>
            </div>

            <div class="card">
                <h2 class="section-title"><i class="fas fa-trophy"></i> æˆåŠŸæ¡ˆä¾‹ & æ•™å­¦æˆæœ</h2>
                <p id="tHonors" class="content-text">æš‚æ— æ¡ˆä¾‹</p>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 25px;">
                    <h2 class="section-title" style="margin:0; border:none; padding:0;"><i class="fas fa-comments"></i> å­¦å‘˜çœŸå®è¯„ä»·</h2>
                    <span style="font-size:0.9rem; color:var(--text-gray);"><i class="fas fa-lock"></i> å®Œè¯¾å­¦å‘˜å¯è¯„</span>
                </div>
                <div id="reviewList"><div class="empty-state"><i class="fas fa-spinner fa-spin fa-2x"></i></div></div>
            </div>
        </div>

        <div class="side-col">
            <div class="booking-card">
                <div style="margin-bottom: 25px; text-align: center;">
                    <span class="price-val">Â¥<span id="tPrice">-</span></span> <span style="color:var(--text-gray)">/å°æ—¶</span>
                </div>
                
                <div id="bookingFormArea">
                    <label style="display:block; margin-bottom:10px;">æˆè¯¾æ–¹å¼</label>
                    <select id="classType" class="form-area">
                        <option value="çº¿ä¸Šæ•™å­¦">ğŸ’» çº¿ä¸Šäº‘æ•™å®¤ (è¿œç¨‹è¾…å¯¼)</option>
                        <option value="çº¿ä¸‹ä¸Šé—¨">ğŸ  çº¿ä¸‹ä¸Šé—¨ (é¢å¯¹é¢æˆè¯¾)</option>
                    </select>

                    <label style="display:block; margin-bottom:10px;">é¢„çº¦ä¸Šè¯¾æ—¶é—´</label>
                    <input type="datetime-local" id="bookTime" class="form-area" style="height:auto;">
                    
                    <label style="display:block; margin-bottom:10px;">å¤‡æ³¨éœ€æ±‚</label>
                    <textarea id="bookReq" class="form-area" rows="4" placeholder="è¯·å¡«å†™å­©å­çš„å¹´çº§ã€è–„å¼±é¡¹ã€ä¸Šè¯¾åœ°å€(è‹¥çº¿ä¸‹)..."></textarea>
                </div>

                <button class="btn btn-primary" id="btnBook" onclick="doBook()">ç«‹å³é¢„çº¦è¯•è¯¾</button>
                <button class="btn btn-outline" id="btnChat" onclick="checkChatPermission()">åœ¨çº¿å’¨è¯¢ / ç§ä¿¡</button>
                
                <div class="trust-badges">
                    <div class="trust-item"><i class="fas fa-shield-alt"></i> å®˜æ–¹è®¤è¯</div>
                    <div class="trust-item"><i class="fas fa-check-circle"></i> æ‹…ä¿äº¤æ˜“</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const tid = params.get('id');
        let tutorName = '';
        let canChat = false; 
        let isFav = false; // æ”¶è—çŠ¶æ€

        if(!tid) { alert('å‚æ•°é”™è¯¯'); location.href='index.html'; }

        fetch(`api/teacher_api.php?action=get_info&id=${tid}&_t=${Date.now()}`).then(r=>r.json()).then(res=>{
            const t = res.data;
            if(!t) { alert('æ•™å‘˜ä¸å­˜åœ¨'); location.href='index.html'; return; }
            
            tutorName = t.name;
            document.title = `${t.name}è€å¸ˆ - æ•™å‘˜è¯¦æƒ…`;
            document.getElementById('tName').innerText = t.name + ' è€å¸ˆ';
            let avatarPath = t.avatar || 'default_boy.png';
            if(!avatarPath.includes('/') && !avatarPath.startsWith('http')) avatarPath = 'assets/' + avatarPath;
            document.getElementById('tAvatar').src = avatarPath;
            document.getElementById('tPrice').innerText = t.price;
            document.getElementById('tIntro').innerText = t.intro || 'è¿™ä½è€å¸ˆå¾ˆä½è°ƒï¼Œæš‚æ—¶æ²¡æœ‰å¡«å†™è¯¦ç»†ä»‹ç»ã€‚';
            document.getElementById('tHonors').innerText = t.honors || 'æš‚æ— å…¬å¼€çš„æˆåŠŸæ¡ˆä¾‹ã€‚';
            let tags = `<span class="tag">${t.school}</span><span class="tag">${t.major}</span>`;
            if(t.subject) tags += `<span class="tag">${t.subject}</span>`;
            document.getElementById('tTags').innerHTML = tags;

            loadReviews(); 
            checkBookingStatus(); 
            checkFavStatus(); // âœ¨ æ£€æŸ¥æ”¶è—çŠ¶æ€
        });

        // âœ¨ æ£€æŸ¥æ”¶è—çŠ¶æ€
        function checkFavStatus() {
            const phone = localStorage.getItem('userPhone');
            if(!phone) return;
            fetch(`api/user_api.php?action=check_favorite&phone=${phone}&tutor_id=${tid}`)
                .then(r=>r.json()).then(d=>{
                    if(d.is_favorite) setFav(true);
                });
        }

        // âœ¨ åˆ‡æ¢æ”¶è—
        function toggleFav() {
            const phone = localStorage.getItem('userPhone');
            if(!phone) { if(confirm('ç™»å½•åæ‰èƒ½æ”¶è—ï¼Œå»ç™»å½•ï¼Ÿ')) location.href='index.html'; return; }
            
            let fd = new FormData();
            fd.append('phone', phone);
            fd.append('tutor_id', tid);
            
            fetch('api/user_api.php?action=toggle_favorite', {method:'POST', body:fd})
                .then(r=>r.json()).then(d=>{
                    if(d.status==='success') {
                        setFav(d.action === 'added');
                    }
                });
        }

        // æ›´æ–° UI
        function setFav(active) {
            isFav = active;
            const btn = document.getElementById('favBtn');
            const icon = btn.querySelector('i');
            if(active) {
                btn.classList.add('active');
                icon.className = 'fas fa-heart'; // å®å¿ƒå¿ƒ
            } else {
                btn.classList.remove('active');
                icon.className = 'far fa-heart'; // ç©ºå¿ƒå¿ƒ
            }
        }

        function checkBookingStatus() {
            const phone = localStorage.getItem('userPhone');
            if(!phone) return;
            fetch(`api/user_api.php?action=check_booking_status&phone=${phone}&tutor_id=${tid}`)
            .then(r => r.json())
            .then(res => {
                if(res.status === 'success') {
                    canChat = res.can_chat; 
                    if (res.has_active_order) {
                        document.getElementById('bookingFormArea').style.display = 'none';
                        const btnBook = document.getElementById('btnBook');
                        btnBook.innerHTML = '<i class="fas fa-hourglass-half"></i> è¿›è¡Œä¸­ / æŸ¥çœ‹è¿›åº¦';
                        btnBook.className = 'btn btn-booked';
                        btnBook.onclick = function() { location.href = 'student_center.html?view=courses'; };
                    } else if (res.can_chat) {
                        const btnBook = document.getElementById('btnBook');
                        btnBook.innerHTML = '<i class="fas fa-redo"></i> å†æ¬¡é¢„çº¦è¯¾ç¨‹';
                        btnBook.className = 'btn btn-rebook'; 
                    }
                    if (res.can_chat) {
                        const btnChat = document.getElementById('btnChat');
                        btnChat.innerHTML = '<i class="fas fa-comment-dots"></i> ç«‹å³ç§ä¿¡ (å·²è§£é”)';
                        btnChat.className = 'btn btn-chat-active';
                        btnChat.onclick = function() { location.href = `index.html?chat_target=${encodeURIComponent(tutorName)}`; };
                    }
                }
            });
        }

        function checkChatPermission() {
            if (canChat) { location.href = `index.html?chat_target=${encodeURIComponent(tutorName)}`; } else { alert('ğŸ”’ ä¸ºäº†ä¿éšœæœåŠ¡è´¨é‡ï¼Œè¯·å…ˆâ€œé¢„çº¦è¯•è¯¾â€ã€‚\n\né¢„çº¦æˆåŠŸæˆ–å®Œè¯¾åï¼Œæ‚¨å°†è§£é”ä¸è€å¸ˆçš„ç›´æ¥ç§ä¿¡åŠŸèƒ½ã€‚'); }
        }

        function loadReviews() {
            const container = document.getElementById('reviewList');
            fetch(`api/user_api.php?action=get_tutor_reviews&tutor_id=${tid}&_t=${Date.now()}`)
            .then(r => r.json())
            .then(res => {
                const list = res.data;
                if (!list || list.length === 0) { container.innerHTML = `<div class="empty-state"><i class="far fa-comment-dots" style="font-size:3rem; margin-bottom:15px; opacity:0.5;"></i><p>æš‚æ— è¯„ä»·ï¼Œå¿«æ¥é¢„çº¦ä½“éªŒï¼</p></div>`; return; }
                let h = ''; list.forEach(r => { let stars = ''; for(let i=0; i<5; i++) stars += i < r.rating ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>'; h += `<div class="review-item"><div class="review-user"><div class="review-avatar"><i class="fas fa-user"></i></div><div><div style="font-weight:700;">${r.user_phone.substr(0,3)}****${r.user_phone.substr(7)}</div><div style="font-size:0.8rem; color:var(--text-gray);">${r.create_time.split(' ')[0]}</div></div><div class="stars" style="margin-left:auto;">${stars}</div></div><div class="review-content">${r.content || 'ç”¨æˆ·æœªå¡«å†™æ–‡å­—è¯„ä»·ã€‚'}</div></div>`; }); container.innerHTML = h;
            })
            .catch(() => container.innerHTML = '<div class="empty-state">æš‚æ— è¯„ä»·</div>');
        }

        function doBook() {
            const phone = localStorage.getItem('userPhone');
            if(!phone) { if(confirm('æ‚¨éœ€è¦å…ˆç™»å½•å­¦ç”Ÿè´¦å·æ‰èƒ½é¢„çº¦ã€‚\n\næ˜¯å¦ç«‹å³è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Ÿ')) location.href='index.html'; return; }
            
            const time = document.getElementById('bookTime').value;
            const req = document.getElementById('bookReq').value;
            const type = document.getElementById('classType').value; // è·å–æˆè¯¾æ–¹å¼

            if(!time) return alert("è¯·é€‰æ‹©é¢„çº¦æ—¶é—´");
            
            const btn = document.getElementById('btnBook');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æäº¤ä¸­...'; 
            btn.disabled = true;
            
            let fd = new FormData(); 
            fd.append('user_phone', phone); 
            fd.append('tutor_name', tutorName); 
            fd.append('lesson_time', time.replace('T', ' ')); 
            fd.append('class_type', type); // å‘é€æˆè¯¾æ–¹å¼
            fd.append('requirement', req);
            
            fetch('api/user_api.php?action=book_tutor', {method:'POST', body:fd}).then(r=>r.json()).then(d=>{
                if(d.status === 'success') { 
                    alert('âœ… é¢„çº¦ç”³è¯·å·²æäº¤ï¼\n\næ–¹å¼ï¼š' + type + '\nè¯·ç­‰å¾…è€å¸ˆç¡®è®¤ã€‚'); 
                    location.href = 'student_center.html?view=courses'; 
                } else { 
                    btn.innerHTML = 'ç«‹å³é¢„çº¦è¯•è¯¾'; 
                    btn.disabled = false; 
                    alert('âŒ é¢„çº¦å¤±è´¥: ' + d.message); 
                }
            });
        }
    </script>
</body>
</html>